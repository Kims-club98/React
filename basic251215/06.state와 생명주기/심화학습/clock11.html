<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>state와생명주기 11</title>
  <!-- React 라이브러 -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <!-- ReactDOM 라이브러리 -->
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- 바벨 : JSX 사용 -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const root = document.querySelector("#root")
    const Clock = () => {
      console.log('초기화 버튼 클릭 됨.')
      //1) state선언하기 - 현재 시간(화면에 출력할 데이터)
      const [date, setDate] = React.useState(new Date())
      //2) state선언하기 - 타이머 실행 여부(시작버튼/정지버튼 스위치)
      //이 값을 useEffect 의존성 배열에 상태값 사용하기
      const [isRunning, setIsRunning] = React.useState(true)
      //3) useEffect 훅(Hook) - 생명주기 + 부수효과(타이머)
      //-> isRunning 값이 바뀔 때 마다 effect가 다시 실행됨
      // -> 결론: 정지버튼과 시작 버튼이 toggle되고 있어서 상태값이 변할 때(true → false & false → true)
      //          useEffect가 호출됨.
      React.useEffect(() => {
        console.log('effect')
        //3-1 isRunning이 false이면 타이머를 만들지 않고 종료되는지 관찰해 보세요.
        //-> 정지 상태(정지버튼 누름)에서는 시간이 업데이트 되지 않도록 한다. 
        if(!isRunning) return //이 다음 코드는 실행 기회를 갖지 못한다. -> useEffect탈출
        // componentDidMount역할
        //3-2 여기까지 진행이 되었다는 건 isRunning이 true이면 타이머 생성됨
        const timer = setInterval(() => {
          //state 업데이트 한다. -> React가 다시 렌더링 된다. -> 시간이 갱신된다는 것이다.
          setDate(new Date())
        },1000) //두번째파라미터 자리에 mili sec단위 시간
        //3-3 componentWillUnmount 역할 (정리 함수)
        //-> isRunning이 바뀌거나(재실행) 컴포넌트가 사라질 때(언마운트)
        //기존 타이머를 제거해서 중복 타이머를 방지 할 수 있다.
        return () => {
          clearInterval(timer)
        }
      },[isRunning]) //isRunning이 바뀔 때 마다 useEffect재평가
      //타이머 초기화
      const reset = () => {
        setDate(new Date())
        setIsRunning(true)
      }
      //state는 이전 상태값을 기억하고 있다.
      const toggleRunning = () => {
        setIsRunning((prev) => !prev)
      }
      return (
        <>
          <h1>State + useEffect 심화 실습</h1>
          <h2>현재 시간 : {date.toLocaleTimeString()}</h2>
          {/* isRunning 상태에 따라 문구도 달라짐 */}
          <h3>상태 : {isRunning ? "실행 중": "정지"}</h3>
          {/* 버튼을 누르면 state가 바뀌고 화면이 자동 갱신이 되는가? 관찰 */}
          <button onClick={toggleRunning}>
            {isRunning ? "정지(stop)":"시작(Start)"}
          </button>
          <button type="button" onClick={reset}>초기화(Reset)</button>
        </>
      )
    }//end of Clock
    ReactDOM.createRoot(root).render(<Clock />)
  </script>
</body>
</html>